{% extends 'customer/layout/base_customer.html' %}

{% block title %}Keranjang Belanja - E-Commerce{% endblock %}

{% block extra_css %}
<style>
    .cart-theme {
        --primary-color: var(--primary-color);
        --secondary-color: var(--secondary-color);
    }
    .cart-theme .text-primary { color: var(--primary-color) !important; }
    .cart-theme .btn-primary { background-color: var(--primary-color) !important; border-color: var(--primary-color) !important; }
    .cart-theme .badge-primary { background-color: var(--primary-color) !important; color: #fff !important; }
    .cart-theme .card { border-color: rgba(0,0,0,0.04); }
    .cart-theme .card-header .btn-outline-primary { color: var(--primary-color); border-color: var(--primary-color); }
    .cart-theme .card-header .btn-outline-primary:hover { background-color: rgba(87,114,110,0.06); }
    .cart-theme .text-muted { color: rgba(0,0,0,0.5); }
</style>
{% endblock %}

{% block page_heading %}
<div class="d-sm-flex align-items-center justify-content-between mb-4">
    <h1 class="h3 mb-0 text-gray-800">Keranjang Belanja</h1>
</div>
{% endblock %}

{% block content %}
<div class="cart-theme">
{% if keranjang_items %}
<div class="row">
    <div class="col-lg-8">
        <!-- Keranjang Items -->
        <div class="card shadow mb-4">
            <div class="card-header py-3 d-flex align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-primary">
                    <i class="fas fa-shopping-cart"></i> Item di Keranjang ({{ keranjang_items|length }})
                </h6>
                <a href="{{ url_for('landing.cart') }}" class="btn btn-sm btn-outline-primary">Edit Keranjang</a>
            </div>
            <div class="card-body">
                {% for item in keranjang_items %}
                <div class="row mb-3 pb-3 border-bottom align-items-center" id="cart-item-{{ item.id }}">
                    <div class="col-md-2">
                        {% if item.gambar_utama %}
                        <img src="{{ url_for('static', filename='gambar_produk/' + item.gambar_utama) }}" 
                             class="img-fluid rounded" alt="{{ item.nama_barang }}" 
                             style="max-height: 80px; object-fit: cover;">
                        {% else %}
                        <img src="{{ url_for('static', filename='assets_landing/img/product-1.jpg') }}" 
                             class="img-fluid rounded" alt="{{ item.nama_barang }}"
                             style="max-height: 80px; object-fit: cover;">
                        {% endif %}
                    </div>
                    <div class="col-md-4">
                        <h6 class="mb-1">{{ item.nama_barang }}</h6>
                        <small class="text-muted">Stok tersedia: {{ item.stok }}</small>
                    </div>
                    <div class="col-md-2">
                        <p class="mb-0 font-weight-bold">Rp {{ "{:,.0f}".format(item.harga) }}</p>
                        <small class="text-muted">per item</small>
                    </div>
                    <div class="col-md-2">
                        <div class="text-center">
                            <span class="badge badge-primary p-2">Jumlah: {{ item.jumlah }}</span>
                        </div>
                    </div>
                    <div class="col-md-2 text-right">
                        <p class="mb-2 font-weight-bold text-primary" id="subtotal-{{ item.id }}">
                            Rp {{ "{:,.0f}".format(item.harga * item.jumlah) }}
                        </p>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <!-- Ringkasan Belanja -->
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">
                    <i class="fas fa-receipt"></i> Ringkasan Belanja
                </h6>
            </div>
            <div class="card-body">
                {% set total = namespace(value=0) %}
                {% for item in keranjang_items %}
                    {% set total.value = total.value + (item.harga * item.jumlah) %}
                {% endfor %}
                
                <div class="d-flex justify-content-between mb-2">
                    <span>Subtotal ({{ keranjang_items|length }} item)</span>
                    <span id="subtotal-display">Rp {{ "{:,.0f}".format(total.value) }}</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                    <span>Ongkir</span>
                    <span class="text-muted">Dihitung di checkout</span>
                </div>
                <hr>
                <div class="d-flex justify-content-between mb-3">
                    <strong>Total</strong>
                    <strong class="text-primary" id="total-display">Rp {{ "{:,.0f}".format(total.value) }}</strong>
                </div>
                <a href="{{ url_for('landing.checkout') }}" class="btn btn-primary btn-block">
                    <i class="fas fa-credit-card"></i> Lanjut ke Pembayaran
                </a>
            </div>
        </div>

        <!-- Info Pengiriman -->
        <div class="card shadow mb-4">
            <div class="card-body">
                <h6 class="font-weight-bold mb-3">
                    <i class="fas fa-truck"></i> Informasi Pengiriman
                </h6>
                <ul class="list-unstyled mb-0 small">
                    <li class="mb-2"><i class="fas fa-check text-success"></i> Gratis ongkir min. Rp 100.000</li>
                    <li class="mb-2"><i class="fas fa-check text-success"></i> Estimasi pengiriman 2-5 hari</li>
                    <li class="mb-2"><i class="fas fa-check text-success"></i> Garansi produk original</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% else %}
<!-- Keranjang Kosong -->
<div class="row">
    <div class="col-12">
        <div class="card shadow mb-4">
            <div class="card-body text-center py-5">
                <i class="fas fa-shopping-cart fa-5x mb-4" style="color: var(--primary-color);"></i>
                <h4 class="text-primary mb-3">Keranjang Belanja Kosong</h4>
                <p class="text-muted mb-4">Anda belum menambahkan produk ke keranjang</p>
            </div>
        </div>
    </div>
</div>
{% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
// Update total keseluruhan
function updateTotal() {
    var total = 0;
    $('[id^="subtotal-"]').each(function() {
        var subtotalText = $(this).text().replace('Rp ', '').replace(/\./g, '');
        total += parseInt(subtotalText);
    
    });
    
    $('#subtotal-display').text('Rp ' + total.toLocaleString('id-ID'));
    $('#total-display').text('Rp ' + total.toLocaleString('id-ID'));
}

// Checkout handled by /landing/checkout (no client-side stub needed)
</script>
{% endblock %}
